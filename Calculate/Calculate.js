/* eslint-disable require-yield, eqeqeq */

import {
  Sprite,
  Trigger,
  Watcher,
  Costume,
  Color,
  Sound
} from "https://unpkg.com/leopard@^1/dist/index.esm.js";

export default class Calculate extends Sprite {
  constructor(...args) {
    super(...args);

    this.costumes = [
      new Costume("Kostüm1", "./Calculate/costumes/Kostüm1.svg", { x: 0, y: 0 })
    ];

    this.sounds = [new Sound("Plopp", "./Calculate/sounds/Plopp.wav")];

    this.triggers = [
      new Trigger(Trigger.GREEN_FLAG, this.whenGreenFlagClicked),
      new Trigger(Trigger.BROADCAST, { name: "line" }, this.whenIReceiveLine),
      new Trigger(Trigger.CLONE_START, this.startAsClone)
    ];

    this.vars.clone = 0;
    this.vars.xDistance = 0;
    this.vars.yDistance = 0;
    this.vars.points = [
      -145,
      28,
      -145.0830454799,
      27.0034542418,
      -145.1660909598,
      26.0069084836,
      -145.2491364397,
      25.0103627254,
      -145.3321819196,
      24.0138169672,
      -145.4152273995,
      23.017271209,
      -145.4982728794,
      22.0207254508,
      -145.5813183593,
      21.0241796926,
      -145.6643638392,
      20.0276339344,
      -145.7474093191,
      19.0310881762,
      -145.830454799,
      18.034542418,
      -145.9135002789,
      17.0379966598,
      -146,
      16,
      -145.8585786438,
      15.0100505063,
      -145.7171572876,
      14.0201010126,
      -145.5757359314,
      13.0301515189,
      -145.4343145752,
      12.0402020252,
      -145.292893219,
      11.0502525315,
      -145.1514718628,
      10.0603030378,
      -145.0100505066,
      9.070353544100001,
      -144.8686291504,
      8.0804040504,
      -144.7272077942,
      7.090454556700001,
      -144.585786438,
      6.100505063,
      -144.4443650818,
      5.110555569300001,
      -144.3029437256,
      4.120606075600001,
      -144.1615223694,
      3.1306565819000003,
      -144,
      2,
      -143.4550116494,
      1.1615563837,
      -142.9100232988,
      0.32311276740000006,
      -142.3650349482,
      -0.5153308488999997,
      -141.8200465976,
      -1.3537744651999999,
      -141.275058247,
      -2.1922180815,
      -140.7300698964,
      -3.0306616977999994,
      -140.1850815458,
      -3.8691053140999996,
      -139.6400931952,
      -4.7075489304,
      -139.0951048446,
      -5.5459925467,
      -138.550116494,
      -6.384436163,
      -138.0051281434,
      -7.2228797792999995,
      -137.4601397928,
      -8.061323395599999,
      -136.9151514422,
      -8.8997670119,
      -136.3701630916,
      -9.7382106282,
      -135.825174741,
      -10.5766542445,
      -135.2801863904,
      -11.4150978608,
      -134.7351980398,
      -12.253541477099999,
      -134.1902096892,
      -13.0919850934,
      -133.6452213386,
      -13.9304287097,
      -133.10023298800002,
      -14.768872326,
      -132.5552446374,
      -15.607315942299998,
      -132.0102562868,
      -16.4457595586,
      -131.4652679362,
      -17.2842031749,
      -130.9202795856,
      -18.122646791199998,
      -130.375291235,
      -18.9610904075,
      -129.8303028844,
      -19.7995340238,
      -129.2853145338,
      -20.6379776401,
      -128.7403261832,
      -21.4764212564,
      -128.1953378326,
      -22.3148648727,
      -127.650349482,
      -23.153308489,
      -127.1053611314,
      -23.991752105299998,
      -126.56037278080001,
      -24.8301957216,
      -126.0153844302,
      -25.6686393379,
      -125.4703960796,
      -26.507082954199998,
      -124.925407729,
      -27.3455265705,
      -124.3804193784,
      -28.1839701868,
      -123.8354310278,
      -29.022413803099997,
      -123.2904426772,
      -29.8608574194,
      -122.7454543266,
      -30.699301035699996,
      -122.200465976,
      -31.537744652,
      -121.65547762540001,
      -32.3761882683,
      -121.1104892748,
      -33.214631884599996,
      -120.5655009242,
      -34.0530755009,
      -120.0205125736,
      -34.8915191172,
      -119.47552422300001,
      -35.729962733499995,
      -118.9305358724,
      -36.5684063498,
      -118.3855475218,
      -37.4068499661,
      -118,
      -38,
      -117.3042047842,
      -38.7182402228,
      -116.6084095684,
      -39.4364804456,
      -115.9126143526,
      -40.1547206684,
      -115.2168191368,
      -40.8729608912,
      -114.521023921,
      -41.591201114,
      -113.8252287052,
      -42.3094413368,
      -113.1294334894,
      -43.0276815596,
      -112.4336382736,
      -43.7459217824,
      -111.7378430578,
      -44.4641620052,
      -111.042047842,
      -45.182402228,
      -110.3462526262,
      -45.9006424508,
      -109.6504574104,
      -46.6188826736,
      -108.9546621946,
      -47.337122896400004,
      -108.2588669788,
      -48.055363119199995,
      -107.563071763,
      -48.773603342,
      -106.86727654719999,
      -49.4918435648,
      -106.1714813314,
      -50.2100837876,
      -105.4756861156,
      -50.928324010400004,
      -104.7798908998,
      -51.646564233199996,
      -104.084095684,
      -52.364804456,
      -103.3883004682,
      -53.0830446788,
      -102.6925052524,
      -53.8012849016,
      -101.9967100366,
      -54.519525124400005,
      -101.3009148208,
      -55.237765347199996,
      -100.605119605,
      -55.95600557,
      -99.9093243892,
      -56.6742457928,
      -99.21352917339999,
      -57.3924860156,
      -98.5177339576,
      -58.1107262384,
      -97.8219387418,
      -58.8289664612,
      -97.12614352599999,
      -59.547206684,
      -96.4303483102,
      -60.2654469068,
      -95.7345530944,
      -60.9836871296,
      -95.0387578786,
      -61.7019273524,
      -94.3429626628,
      -62.4201675752,
      -93.647167447,
      -63.138407798,
      -92.9513722312,
      -63.8566480208,
      -92.25557701540001,
      -64.5748882436,
      -91.5597817996,
      -65.29312846639999,
      -90.8639865838,
      -66.0113686892,
      -90.168191368,
      -66.729608912,
      -89.47239615219999,
      -67.4478491348,
      -88.7766009364,
      -68.1660893576,
      -88.0808057206,
      -68.88432958039999,
      -87.3850105048,
      -69.6025698032,
      -87,
      -70,
      -86.1010101312,
      -70.4379694233,
      -85.2020202624,
      -70.8759388466,
      -84.3030303936,
      -71.3139082699,
      -83.4040405248,
      -71.7518776932,
      -82.505050656,
      -72.1898471165,
      -81.6060607872,
      -72.6278165398,
      -80.7070709184,
      -73.0657859631,
      -79.8080810496,
      -73.5037553864,
      -78.9090911808,
      -73.9417248097,
      -78.010101312,
      -74.379694233,
      -77.1111114432,
      -74.8176636563,
      -76.2121215744,
      -75.2556330796,
      -75.3131317056,
      -75.6936025029,
      -74.4141418368,
      -76.1315719262,
      -73.515151968,
      -76.5695413495,
      -72.6161620992,
      -77.0075107728,
      -71.7171722304,
      -77.4454801961,
      -70.81818236160001,
      -77.8834496194,
      -69.9191924928,
      -78.3214190427,
      -69.020202624,
      -78.759388466,
      -68.1212127552,
      -79.1973578893,
      -67.2222228864,
      -79.6353273126,
      -66.3232330176,
      -80.0732967359,
      -65.4242431488,
      -80.5112661592,
      -64.52525328,
      -80.9492355825,
      -63.6262634112,
      -81.3872050058,
      -62.7272735424,
      -81.8251744291,
      -61.8282836736,
      -82.26314385239999,
      -60.9292938048,
      -82.7011132757,
      -60.030303935999996,
      -83.139082699,
      -59.1313140672,
      -83.5770521223,
      -58.2323241984,
      -84.0150215456,
      -57.3333343296,
      -84.4529909689,
      -56.434344460800006,
      -84.8909603922,
      -55.535354592000004,
      -85.3289298155,
      -54.6363647232,
      -85.7668992388,
      -53.7373748544,
      -86.2048686621,
      -52.8383849856,
      -86.6428380854,
      -51.9393951168,
      -87.0808075087,
      -51.040405248,
      -87.51877693200001,
      -50.1414153792,
      -87.9567463553,
      -49.242425510400004,
      -88.3947157786,
      -48,
      -89,
      -47.0203972994,
      -89.2009441437,
      -46.0407945988,
      -89.4018882874,
      -45.0611918982,
      -89.6028324311,
      -44.0815891976,
      -89.8037765748,
      -43.101986497,
      -90.0047207185,
      -42.1223837964,
      -90.2056648622,
      -41.142781095800004,
      -90.4066090059,
      -40.1631783952,
      -90.6075531496,
      -39.1835756946,
      -90.8084972933,
      -38.203972994,
      -91.009441437,
      -37.2243702934,
      -91.2103855807,
      -36.2447675928,
      -91.4113297244,
      -35.2651648922,
      -91.6122738681,
      -34.2855621916,
      -91.8132180118,
      -33.305959490999996,
      -92.0141621555,
      -32.3263567904,
      -92.2151062992,
      -31.3467540898,
      -92.4160504429,
      -30.3671513892,
      -92.6169945866,
      -29.3875486886,
      -92.8179387303,
      -28.407945988,
      -93.018882874,
      -27.4283432874,
      -93.2198270177,
      -26.4487405868,
      -93.4207711614,
      -25.4691378862,
      -93.6217153051,
      -24.4895351856,
      -93.8226594488,
      -23.509932485,
      -94.0236035925,
      -22.5303297844,
      -94.2245477362,
      -21.550727083800002,
      -94.4254918799,
      -20.5711243832,
      -94.62643602360001,
      -19.5915216826,
      -94.82738016729999,
      -18.611918982,
      -95.028324311,
      -17.6323162814,
      -95.2292684547,
      -16.6527135808,
      -95.4302125984,
      -15.6731108802,
      -95.6311567421,
      -14.693508179600002,
      -95.8321008858,
      -13.713905478999997,
      -96.0330450295,
      -12.7343027784,
      -96.2339891732,
      -11.754700077800003,
      -96.4349333169,
      -10.775097377199998,
      -96.6358774606,
      -9.7954946766,
      -96.8368216043,
      -9,
      -97,
      -8,
      -97,
      -7,
      -97,
      -6,
      -97,
      -5,
      -97,
      -4,
      -97,
      -3,
      -97,
      -2,
      -97,
      -1,
      -97,
      0,
      -97,
      1,
      -97,
      2,
      -97,
      3,
      -97,
      4,
      -97,
      5,
      -97,
      6,
      -97,
      7,
      -97,
      8,
      -97,
      9,
      -97,
      10,
      -97,
      11,
      -97,
      12,
      -97,
      13,
      -97,
      14,
      -97,
      15,
      -97,
      16,
      -97,
      17,
      -97,
      18,
      -97,
      19,
      -97,
      20,
      -97,
      21,
      -97,
      22,
      -97,
      23,
      -97,
      24,
      -97,
      25,
      -97,
      26,
      -97,
      27,
      -97,
      28,
      -97,
      29,
      -97,
      30,
      -97,
      31,
      -97,
      32,
      -97,
      33,
      -97,
      34,
      -97,
      35,
      -97,
      36,
      -97,
      36.8,
      -96.4,
      37.6,
      -95.8,
      38.4,
      -95.2,
      39.2,
      -94.6,
      40,
      -94,
      40.8,
      -93.4,
      41.6,
      -92.8,
      42.4,
      -92.2,
      43.2,
      -91.6,
      44,
      -91,
      44.8,
      -90.4,
      45.6,
      -89.8,
      46.4,
      -89.2,
      47.2,
      -88.6,
      48,
      -88,
      48.7281999927,
      -87.314635301,
      49.4563999854,
      -86.629270602,
      50.1845999781,
      -85.943905903,
      50.9127999708,
      -85.258541204,
      51.6409999635,
      -84.573176505,
      52.3691999562,
      -83.887811806,
      53.0973999489,
      -83.202447107,
      53.825599941600004,
      -82.517082408,
      54.5537999343,
      -81.831717709,
      55.281999927,
      -81.14635301,
      56.0101999197,
      -80.460988311,
      56.7383999124,
      -79.775623612,
      57.4665999051,
      -79.090258913,
      58.194799897799996,
      -78.404894214,
      58.9229998905,
      -77.719529515,
      59.6511998832,
      -77.034164816,
      60.3793998759,
      -76.348800117,
      61.107599868600005,
      -75.663435418,
      61.8357998613,
      -74.978070719,
      62.563999854,
      -74.29270602,
      63.2921998467,
      -73.607341321,
      64.0203998394,
      -72.921976622,
      65,
      -72,
      65.718988376,
      -71.3049779032,
      66.437976752,
      -70.6099558064,
      67.156965128,
      -69.9149337096,
      67.875953504,
      -69.2199116128,
      68.59494188,
      -68.524889516,
      69.313930256,
      -67.8298674192,
      70.032918632,
      -67.1348453224,
      70.751907008,
      -66.4398232256,
      71.470895384,
      -65.7448011288,
      72.18988376,
      -65.049779032,
      72.908872136,
      -64.3547569352,
      73.627860512,
      -63.6597348384,
      74.346848888,
      -62.964712741599996,
      75.065837264,
      -62.2696906448,
      75.78482564,
      -61.574668548,
      76.503814016,
      -60.8796464512,
      77.222802392,
      -60.1846243544,
      77.941790768,
      -59.4896022576,
      78.660779144,
      -58.794580160799995,
      79.37976752,
      -58.099558064,
      80.098755896,
      -57.4045359672,
      80.817744272,
      -56.7095138704,
      81.536732648,
      -56.0144917736,
      82.255721024,
      -55.3194696768,
      82.9747094,
      -54.624447579999995,
      83.693697776,
      -53.9294254832,
      84.41268615199999,
      -53.234403386400004,
      85.13167452799999,
      -52.5393812896,
      85.850662904,
      -51.8443591928,
      86.56965128,
      -51.149337096,
      87.288639656,
      -50.454314999199994,
      88.007628032,
      -49.7592929024,
      88.726616408,
      -49.0642708056,
      89.445604784,
      -48.3692487088,
      90.16459316,
      -47.674226612,
      90.88358153600001,
      -46.979204515199996,
      91.602569912,
      -46.28418241839999,
      92.321558288,
      -45.5891603216,
      93.040546664,
      -44.8941382248,
      93.75953504,
      -44.199116128,
      94.478523416,
      -43.5040940312,
      95,
      -43,
      95.8,
      -42.4,
      96.6,
      -41.8,
      97.4,
      -41.2,
      98.2,
      -40.6,
      99,
      -40,
      99.8,
      -39.4,
      100.6,
      -38.8,
      101.4,
      -38.2,
      102.2,
      -37.6,
      103,
      -37,
      103.8,
      -36.4,
      104.6,
      -35.8,
      105.4,
      -35.2,
      106.2,
      -34.6,
      107,
      -34,
      107.8,
      -33.4,
      108.6,
      -32.8,
      109.4,
      -32.2,
      110.2,
      -31.6,
      111,
      -31,
      111.8,
      -30.4,
      112.6,
      -29.8,
      113.4,
      -29.200000000000003,
      114.2,
      -28.6,
      115,
      -28,
      115.8,
      -27.4,
      116.6,
      -26.8,
      117.4,
      -26.2,
      118.2,
      -25.6,
      119,
      -25,
      119.9079593845,
      -24.5809418225,
      120.815918769,
      -24.161883645,
      121.7238781535,
      -23.7428254675,
      122.631837538,
      -23.32376729,
      123.5397969225,
      -22.9047091125,
      124.447756307,
      -22.485650935,
      125.3557156915,
      -22.0665927575,
      126.263675076,
      -21.64753458,
      127.1716344605,
      -21.2284764025,
      128.079593845,
      -20.809418225,
      128.9875532295,
      -20.3903600475,
      129.895512614,
      -19.971301869999998,
      130.80347199850002,
      -19.5522436925,
      132,
      -19,
      132.9970544855,
      -18.9233035011,
      133.994108971,
      -18.8466070022,
      134.9911634565,
      -18.7699105033,
      135.988217942,
      -18.6932140044,
      136.9852724275,
      -18.6165175055,
      137.982326913,
      -18.5398210066,
      138.9793813985,
      -18.4631245077,
      139.976435884,
      -18.3864280088,
      140.9734903695,
      -18.3097315099,
      141.970544855,
      -18.233035011,
      142.9675993405,
      -18.1563385121,
      143.964653826,
      -18.0796420132,
      145,
      -18,
      145.9863939238,
      -17.8356010127,
      146.9727878476,
      -17.6712020254,
      147.9591817714,
      -17.5068030381,
      148.9455756952,
      -17.3424040508,
      149.931969619,
      -17.1780050635,
      150.9183635428,
      -17.0136060762,
      151.9047574666,
      -16.849207088900002,
      152.8911513904,
      -16.6848081016,
      153.8775453142,
      -16.5204091143,
      154.863939238,
      -16.356010127,
      155.8503331618,
      -16.1916111397
    ];
  }

  *search() {
    this.vars.points = [];
    this.stage.vars.i = 1;
    this.stage.vars.help = 0;
    while (
      !(
        this.compare(this.stage.vars.penX.length, this.stage.vars.i) === 0 &&
        this.toString(
          this.itemOf(this.stage.vars.penY, this.stage.vars.penY.length - 1)
        ) === "#"
      )
    ) {
      if (
        !(
          this.toNumber(
            this.itemOf(this.stage.vars.penX, this.stage.vars.i - 1)
          ) === 0
        )
      ) {
        this.goto(
          this.toNumber(
            this.itemOf(this.stage.vars.penX, this.stage.vars.i - 1)
          ),
          this.toNumber(
            this.itemOf(this.stage.vars.penY, this.stage.vars.i - 1)
          )
        );
        yield* this.pointTowards(
          this.itemOf(this.stage.vars.penX, this.toNumber(this.stage.vars.i)),
          this.itemOf(this.stage.vars.penY, this.toNumber(this.stage.vars.i))
        );
        this.vars.xDistance =
          this.x -
          this.toNumber(
            this.itemOf(this.stage.vars.penX, this.toNumber(this.stage.vars.i))
          );
        this.vars.yDistance =
          this.y -
          this.toNumber(
            this.itemOf(this.stage.vars.penY, this.toNumber(this.stage.vars.i))
          );
        yield* this.calculate(
          Math.sqrt(
            this.toNumber(this.vars.xDistance) *
              this.toNumber(this.vars.xDistance) +
              this.toNumber(this.vars.yDistance) *
                this.toNumber(this.vars.yDistance)
          ),
          this.direction
        );
        this.stage.vars.i++;
      }
      yield;
    }
  }

  *calculate(distance, direction) {
    this.stage.vars.distance = 0;
    for (let i = 0; i < this.toNumber(distance); i++) {
      this.vars.points.push(
        Math.sin(this.degToRad(this.toNumber(direction))) *
          this.toNumber(this.stage.vars.distance) +
          this.x
      );
      this.vars.points.push(
        Math.cos(this.degToRad(this.toNumber(direction))) *
          this.toNumber(this.stage.vars.distance) +
          this.y
      );
      this.stage.vars.distance++;
    }
  }

  *whenGreenFlagClicked() {
    this.penDown = false;
    this.vars.clone = 0;
  }

  *rainbow() {
    this.penDown = false;
    this.stage.vars.index = 1;
    for (let i = 0; i < this.vars.points.length / 2; i++) {
      this.penColor.h = this.x * (200 / 480);
      this.goto(
        this.toNumber(this.itemOf(this.vars.points, this.stage.vars.index - 1)),
        this.toNumber(
          this.itemOf(this.vars.points, this.toNumber(this.stage.vars.index))
        )
      );
      this.penDown = true;
      this.stage.vars.index += 2;
    }
  }

  *draw() {
    this.penSize = 20;
    this.penColor = Color.rgb(255, 0, 0);
    this.penColor.v = 40;
    for (let i = 0; i < 10; i++) {
      this.warp(this.rainbow)();
      this.penSize -= 1;
      this.penColor.v += 4;
    }
    this.penColor.v = 100;
    this.warp(this.rainbow)();
  }

  *whenIReceiveLine() {
    if (this.toNumber(this.vars.clone) === 0) {
      this.createClone();
    }
  }

  *startAsClone() {
    this.vars.clone = 1;
    while (!(this.compare(this.stage.vars.penY.length, 1) > 0)) {
      yield;
    }
    yield* this.search();
    this.stage.vars.ok = 1;
    yield* this.draw();
  }

  *pointTowards(x, y) {
    if (!(this.compare(y, this.y) < 0)) {
      this.direction = this.radToDeg(
        Math.atan((this.toNumber(x) - this.x) / (this.toNumber(y) - this.y))
      );
    } else {
      this.direction =
        180 +
        this.radToDeg(
          Math.atan((this.toNumber(x) - this.x) / (this.toNumber(y) - this.y))
        );
    }
  }
}
